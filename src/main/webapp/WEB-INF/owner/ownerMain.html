<html>
<head>
    <meta charset="UTF-8">
    <title>我的博客</title>
    <link type="images/x-icon" rel="shortcut icon" href="/imgs/blog_icon.png">
    <!--   VUE-->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!--  jQuery-->
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/constants.js"></script>
    <script src="/js/ownerVerify.js"></script>
    <script src="/js/showOrHiddenLoadingDiv.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/moduleChoice.css">
    <link rel="stylesheet" type="text/css" href="/css/showPictureTable.css">
    <link rel="stylesheet" type="text/css" href="/css/articleChoiceChildDiv.css">
    <link rel="stylesheet" type="text/css" href="/css/mainShow.css">
    <link rel="stylesheet" type="text/css" href="/css/loadingDiv.css">
<!--
 <link type="images/x-icon" rel="shortcut icon" href="/pblog/imgs/blog_icon.png">
    <script src="/pblog/js/jquery-3.4.1.min.js"></script>
    <script src="/pblog/js/constants.js"></script>
    <script src="/pblog/js/ownerVerify.js"></script>
    <script src="/pblog/js/showOrHiddenLoadingDiv.js"></script>
    <link rel="stylesheet" type="text/css" href="/pblog/css/moduleChoice.css">
    <link rel="stylesheet" type="text/css" href="/pblog/css/showPictureTable.css">
    <link rel="stylesheet" type="text/css" href="/pblog/css/articleChoiceChildDiv.css">
    <link rel="stylesheet" type="text/css" href="/pblog/css/mainShow.css">
    <link rel="stylesheet" type="text/css" href="/pblog/css/loadingDiv.css">
-->
    <!--    css-->
    <style>
        /*信息编辑*/
        .edit_owner_info_div {
            position: fixed;
            width: 10%;
            top: 80%;
            left: 10%;
        }

        .edit_owner_info_div img {
            width: 25%;
        }

        .edit_ino_span:hover {
            color: cyan;
        }

        /* 添加内容的img */
        .add_content_img {
            position: fixed;
            width: 3.5%;
            right: 2%;
            bottom: 8%;
        }

        /* 添加内容的div */
        .add_content_div {
            position: fixed;
            right: 1.4%;
            top: 11%;
            width: 5%;
            height: 0%;
            border-radius: 30px 30px 30px 30px;
            background: #5CD74C;
            opacity: 0.7;
            /*overflow-y: auto;*/
        }

        .add_content_div img {
            width: 70%
        }

        .add_content_module_img {
            visibility: hidden;
            margin-left: 50%;
            transform: translateX(-50%);
            margin-top: 50%;
        }

        /* 浏览记录 */
        .browse_number_img {
            position: fixed;
            width: 2%;
            margin-left: 94.5%;
            overflow-y: scroll
        }

        .other_link_img {
            position: fixed;
            width: 2.5%;
            bottom: 2%;
            left: 11%;
        }

        .logout_img {
            position: fixed;
            width: 2.5%;
            bottom: 2%;
            left: 16%;
        }
    </style>
</head>

<body style="background-image:url('/imgs/main_bg.jpg');background-repeat: repeat-y">
<!-- 装饰区域 -->
<div class="decorate_div">
    <canvas class="decorate_canvas" id="decorate_canvas"></canvas>
</div>

<div class="loading_div" id="loading_div">
    <div></div>
    <img src="/imgs/loading.gif"/></div>
<!-- 自我介绍区域-->
<div id="profile_div">
    <img id="mylogo_img"/>
    </br>
    <div class="div_include_img_text">
        <img id="introduce_img" src="/imgs/introduce_icon.png"/>
        <span class="in_span_text" id="introduce_span">简介</span>
    </div>

    <div class="div_include_img_text">
        <img id="habit_img" src="/imgs/heart_icon.png"/>
        <span class="in_span_text" id="habit_span">爱好</span>
    </div>

    <div class="edit_owner_info_div">
        <img src="/imgs/edit_icon.png"/>
        <span class="edit_ino_span" id="edit_info_id_span">编辑信息</span>
    </div>

</div>
<!--博客内容显示区域-->
<div id="blog_main_content_div">
    <!-- 标题 -->
    <div class="title_div" id="title_div">壮志凌云</div>
    <!-- 上部背景图 -->
    <img class='top_bg_img' id="top_bg_img" src="/imgs/aircraft.jpg"/>
    <!-- 格言 -->
    <div class="dictum_div" id="dictum_div">好好学习天天向上！！！</div>
    <!-- 模块 -->
    <table class="func_module_table" align="center">
        <tr>
            <td><span id="leisureArticle_span">休闲文章</span></td>
            <td><span id="professionalArticle_span">专业文章</span></td>
            <td><span id="photos_span">照片</span></td>
            <td><span id="docs_span">文档</span></td>
        </tr>
    </table>
    <!--内容显示区域-->
    <div class="content_show_div">
    </div>
    <!--分页区域-->
    <div class="paging_area_div" id="paging_area_div">
        <img src="/imgs/left_arrow_icon.png" title="上一页" class="left_arrow_img" id="left_arrow_img"/>
        <img src="/imgs/right_arrow_icon.png" title="下一页" class="right_arrow_img" id="right_arrow_img"/>
        <!-- 索引区域 -->
        <table class="paging_table" id="paging_table">
            <tr class="paging_tr" id="paging_tr">
                <!--                <td class="paging_td">1</td>-->
                <!--                <td class="paging_td">1</td>-->
                <!--                <td class="paging_td">1</td>-->
                <!--                <td class="paging_td">1</td>-->
                <!--                <td class="paging_td">1</td>-->
                <!--                <td class="paging_td">1</td>-->
                <!--                <td class="paging_td">1</td>-->
            </tr>
        </table>
    </div>
</div>


<!-- 添加内容的img -->
<img class="add_content_img" src="/imgs/plus_icon.png"/>
<!-- 添加内容的div -->
<div class="add_content_div">
    <img class='add_content_module_img' id="leisure_article_add_img" src="/imgs/leisure_article_icon.png"
         title="休闲文章"/>
    <img class='add_content_module_img' id="professional_article_add_img" src="/imgs/professional_article_icon.png"
         title="专业文章"/>
    <img class='add_content_module_img' id="picture_add_img" src="/imgs/picture_icon.png"
         title="照片"/>
    <img class='add_content_module_img' id="doc_add_img" src="/imgs/doc_icon.png"
         title="文档"/>
</div>
<!-- 浏览次数 -->
<img class="browse_number_img" id="browse_number_img" src="/imgs/record_icon.png"/>

<img class="other_link_img" id="other_link_img" src="/imgs/up_arrow_icon.png"/>
<img class="logout_img" id="logout_img" src="/imgs/logout_icon.png" title="下线"/>
</body>
<script src="/js/createShowPictureTable.js"></script>
<script src="/js/createShowDocsTable.js"></script>
<script src="/js/mainShowLogic.js"></script>

<!--
<script src="/pblog/js/createShowPictureTable.js"></script>
<script src="/pblog/js/createShowDocsTable.js"></script>
<script src="/pblog/js/mainShowLogic.js"></script>
-->
<!--博客拥有者下线-->
<script>
    // //监听网页的关闭事件
    // $(window).on("beforeunload", function () {
    //     logoutFunc();
    // });
    var logoutFunc = function () {
        $.ajax({
            method: 'POST',
            url: 'http://' + IP + ':' + PORT_PATH + '/ownerInfo/logout',
            dataType: 'text',
            success: function (data) {
                if (data !== FAILURE) {
                    window.location.href = 'http://' + IP + ':' + PORT_PATH + '/owner/login.html';
                } else {
                    alert('下线失败!!!')
                }
            }
        }).fail(function () {
            if (confirm("网络连接失败，重新连接？？？"))
                logoutFunc();
        });
    };
    $('#logout_img').click(function () {
        logoutFunc();
    });
</script>
<!-- 其他模块点击区域 -->
<script>
    let rotateNumber = 1;
    $('#other_link_img').click(function () {
        if (rotateNumber % 2 === 0) {
            $('#other_link_div').remove();
            $(this).css({
                'transform': 'rotate(' + (180 * rotateNumber++) + 'deg)'
            });
        } else {
            let div = $('<div class="other_link_div" id="other_link_div"></div>');
            div.css({
                'position': 'fixed',
                'background': '#D52D49',
                'height': '10%',
                'width': '15%',
                'left': '10%',
                'bottom': '10%',
                'opacity': '0.7',
                'overflow-x': 'auto',
                'text-align': 'center'
            });
            div.append($('<img id="comment_receive_img" src="/imgs/comment_icon.png" style="position:relative;width: 25%;top: 50%;transform: translateY(-50%)"/>'));
            $('body').append(div);
            $('#comment_receive_img').click(function () {
                /*
                  前往评论显示区域
                 */
                window.open('http://' + IP + ':' + PORT_PATH + '/owner/viewArticleComments.html', "_blank");
            });
            $(this).css({
                'transform': 'rotate(' + (180 * rotateNumber++) + 'deg)'
            });
        }
    });
</script>
<script>
    var modifyTextDicCmd = function (type) {
        let div = document.createElement('div');
        div.setAttribute('class', 'modify_dictum_div');

        if (type !== 'titleBg') {
            let textArea = document.createElement('textarea');
            textArea.setAttribute('class', 'modify_dictum_textarea');
            div.append(textArea);
            let button = document.createElement('button');
            button.innerHTML = '确认修改';
            button.setAttribute('class', 'modify_dictum_button');
            button.onclick = function () {
                //文本的修改
                let text = textArea.value.trim();
                if (type === 'dictum') {
                    if (text) {
                        modifyTitleDictumDAjaxFunc({dictum: text}, 'http://' + IP + ':' + PORT_PATH + '/data/updateTitleDictumDInfo');
                    }
                } else if (type === 'titleName') {
                    if (text) {
                        modifyTitleDictumDAjaxFunc({titleName: text}, 'http://' + IP + ':' + PORT_PATH + '/data/updateTitleDictumDInfo');
                    }
                }
                div.remove();
            };
            div.append(button);
        }
        //标题的背景的修改
        else {
            let input = document.createElement("input");
            input.setAttribute('class', 'modify_dictum_button');
            input.setAttribute('type', 'file');
            input.setAttribute('accept', 'image/jpeg,image/png');
            input.onchange = function () {
                let resultFile = this.files[0];
                showOrHiddenLoadingDiv(true);
                /**
                 * 使用promise异步加载
                 * @type {Promise}
                 */
                let promise = new Promise(function (resolve, reject) {
                    let reader = new FileReader();
                    reader.onload = function () {
                        console.log(this.result);
                        showOrHiddenLoadingDiv(false);
                        input.value = '';
                        modifyTitleDictumDAjaxFunc({titleBg: this.result}, 'http://' + IP + ':' + PORT_PATH + '/data/updateTitleDictumDInfo');
                    };
                    reader.readAsDataURL(resultFile);
                });
                //加载失败
                promise.catch(function (reason) {
                    showOrHiddenLoadingDiv(false);
                    alert(reason)
                })
            };
            div.append(input);
        }

        let buttonCancel = document.createElement('button');
        buttonCancel.innerHTML = '取消';
        buttonCancel.setAttribute('class', 'modify_dictum_buttonCancel');
        buttonCancel.onclick = function () {
            div.remove();
        };
        div.append(buttonCancel);
        $('body').append(div);
        $('.modify_dictum_div').css({
            'position': 'fixed',
            'z-index': '100',
            'width': '40%',
            'height': '40%',
            'margin': '15% 0 0 50%',
            'transform': 'translateX(-50%)',
            'background': '#646D6A',
            'text-align': 'center'
        });
        if (type !== 'titleBg')
            $('.modify_dictum_textarea').css({
                'width': '80%',
                'height': '50%',
                'margin-left': '50%',
                'margin-top': '3%',
                'transform': 'translateX(-50%)'
            });
        $('.modify_dictum_button').css({
            'width': '60%',
            'height': '15%',
            'text-align': 'center',
            'margin-top': '3%',
            'border-radius': '10px'
        });
        $('.modify_dictum_buttonCancel').css({
            'width': '60%',
            'height': '15%',
            'text-align': 'center',
            'margin-top': '1%',
            'border-radius': '10px'
        });
    };
    var modifyTitleDictumDAjaxFunc = function (sendDataObj, url) {
        $.ajax({
            method: 'POST',
            url: url,
            data: sendDataObj,
            dataType: 'text',
            success: function (data) {
                if (data !== FAILURE) {
                    if (sendDataObj.dictum) {
                        $('#dictum_div').html(sendDataObj.dictum);
                    }
                    if (sendDataObj.titleName) {
                        $('#title_div').html(sendDataObj.titleName);
                    }
                    if (sendDataObj.titleBg) {
                        $('#top_bg_img').attr('src', sendDataObj.titleBg);
                    }
                } else {
                    let failureInfo;
                    if (sendDataObj.dictum)
                        failureInfo = "格言修改失败，重新修改？？？";
                    else if (sendDataObj.titleName)
                        failureInfo = "标题修改失败，重新修改？？？";
                    else if (sendDataObj.titleBg) {
                        failureInfo = "标题背景修改失败，重新修改？？？";
                    }
                    if (confirm(failureInfo)) {
                        modifyTitleDictumDAjaxFunc(sendDataObj, url);
                    }
                }
            }
        }).fail(function () {
            if (confirm("网络请求失败，重新请求？？？")) {
                modifyTitleDictumDAjaxFunc(sendDataObj, url);
            }
        });
    };
    /**
     * 修改格言
     */
    $('#dictum_div').on('click', function () {
        if (confirm("修改格言？？？")) {
            modifyTextDicCmd('dictum');
        }
    });
    /**
     * 标题修改
     */
    $('#title_div').on('click', function () {
        if (confirm("修改标题？？？")) {
            modifyTextDicCmd('titleName');
        }
    });
    /**
     * 标题背景修改
     */
    $('#top_bg_img').on('click', function () {
        if (confirm("修改标题背景？？？")) {
            modifyTextDicCmd('titleBg');
        }
    });

</script>
<script>
    /**
     * blog拥有者：
     * 编辑信息的点击事件
     */
    $("#edit_info_id_span").on("click", function () {
        window.location.href = 'http://' + IP + ':' + PORT_PATH + '/owner/editOwner.html';
    });
    /**
     *blog拥有者：
     * 添加内容img的点击事件
     */
    var rotation = 0;
    var widthValue = 0;
    jQuery.fn.rotate = function (degrees) {
        $(this).css({'transform': 'rotate(' + degrees + 'deg)'});
    };
    $('.add_content_img').click(function () {
        if ($(this).attr('src') === '/imgs/plus_icon.png') {
            if (rotation > 0 && rotation < 360) {
                return;
            }

            var rotateTimer = setInterval(function () {
                widthValue += 1;
                if (widthValue < 70) {
                    $(".add_content_div").css("height", widthValue + '%')
                }
                rotation += (0.36 * 7);
                $(this).rotate(rotation);
                if (rotation >= 360) {
                    $('.add_content_module_img').css('visibility', 'visible');
                    rotation = 0;
                    widthValue = 0;
                    $(this).attr('src', '/imgs/down_icon.png');
                    clearInterval(rotateTimer);

                }
            }.bind(this), 1);
        }
        //取消添加内容
        if ($(this).attr('src') === '/imgs/down_icon.png') {
            if (Number($(this).css("opacity")) < 1)
                return;
            $(this).animate({
                opacity: 0
            }, 500, function () {
                $(this).css("opacity", "1");
                $(this).attr('src', '/imgs/plus_icon.png');
            });
            $('.add_content_div').animate({
                height: '0%'
            }, 500, function () {
                $('.add_content_module_img').css('visibility', 'hidden');
            })
        }
    });


    /**
     *各个添加模块的img的点击事件
     */
    var leisureArticle = '休闲文章';
    var professionalArticle = '专业文章';
    var picture = '照片';
    var doc = '文档';
    var inModuleAddContentCmd = function (moduleType) {
        switch (moduleType) {
            case leisureArticle:
                //跳转到编辑页面
                window.location.href = 'http://' + IP + ':' + PORT_PATH + '/owner/ownerWriteArticle.html';
                break;
            case professionalArticle:
                window.location.href = 'http://' + IP + ':' + PORT_PATH + '/owner/ownerWriteArticle.html';
                break;
            case picture:
                window.location.href = 'http://' + IP + ':' + PORT_PATH + '/owner/ownerChoicePhoto.html';
                break;
            case doc:
                window.location.href = 'http://' + IP + ':' + PORT_PATH + '/owner/ownerChoiceDoc.html';
                break;
        }
    };
    //休闲文章img
    //点击事件
    $('#leisure_article_add_img').click(() => {
        inModuleAddContentCmd(leisureArticle);
    });
    //鼠标悬浮事件
    //专业文章img
    $('#professional_article_add_img').click(() => {
        inModuleAddContentCmd(professionalArticle);
    });
    //图片img
    $('#picture_add_img').click(() => {
        inModuleAddContentCmd(picture);
    });
    //文档img
    $('#doc_add_img').click(() => {
        inModuleAddContentCmd(doc);
    });

</script>
<script>
    /**
     *浏览记录区域
     */
    var loadSiteBrowseNumberAjax;
    var createBrowseRecordDivFunc = () => {
        let browseNumberDiv = document.createElement('div');
        browseNumberDiv.setAttribute('id', 'browse_number_div');


        let span = document.createElement('span');
        span.setAttribute('id', 'browse_number_span');
        span.innerHTML = '点击隐藏';
        span.onclick = () => {
            removeBrowseRecordDivFunc();
        };

        browseNumberDiv.append(span);
        let contentOfSpan = document.createElement('span');
        contentOfSpan.setAttribute('id', 'browse_number_content_span');

        browseNumberDiv.append(span);
        browseNumberDiv.append(contentOfSpan);
        $('body').append(browseNumberDiv);


        $('#browse_number_div').mouseenter(() => {
            leaveImgAndDiv[1] = false;
            viewMouseWhetherInAvailableArea();
        });
        $('#browse_number_div').mouseleave(() => {
            leaveImgAndDiv[1] = true;
        });


        $('#browse_number_span').css({
            'display': 'block',
            'font-weight': 'bold',
            'color': '#79177A',
            'text-align': 'center',
            'cursor': 'pointer'
        });
        $('#browse_number_div').css({
            'position': 'fixed',
            'width': '30%',
            'height': '30%',
            'margin-left': '65%',
            'background': '#50A8D5',
            'border-radius': '10px',
            'overflow-y': 'auto',
            'margin-top': '3%',
            'text-align': 'center'

        });

        let bNumber = '博客浏览次数：';
        //获取网站浏览次数
        if (loadSiteBrowseNumberAjax)
            loadSiteBrowseNumberAjax.abort();
        loadSiteBrowseNumberAjax = $.ajax({
            method: 'POST',
            url: 'http://' + IP + ':' + PORT_PATH + '/ownerInfo/getSiteBrowseNumber',
            dataType: 'text',
            success: function (data) {
                if (data === FAILURE) {
                    contentOfSpan.innerHTML = bNumber + '0<br>';
                }
                contentOfSpan.innerHTML = bNumber + data + '<br>';
            }
        }).fail(function () {
            contentOfSpan.innerHTML = bNumber + '0<br>';
        });
    };
    var removeBrowseRecordDivFunc = () => {
        $('#browse_number_div').remove();
        leaveImgAndDiv[1] = true;
        if (viewInterval)
            clearInterval(viewInterval);
        if (viewTimeOut)
            clearTimeout(viewTimeOut);
    };
    var leaveImgAndDiv = [true, true];
    var leaveMaxMillSeconds = 2500;
    var viewInterval;
    var viewTimeOut;
    //观察鼠标是否在有效区域内
    var viewMouseWhetherInAvailableArea = () => {
        if (viewInterval)
            clearInterval(viewInterval);
        if (viewTimeOut)
            clearTimeout(viewTimeOut);
        viewInterval = setInterval(function () {
            if (leaveImgAndDiv[0] && leaveImgAndDiv[1]) {
                viewTimeOut = setTimeout(removeBrowseRecordDivFunc, leaveMaxMillSeconds);
                clearInterval(viewInterval);
            }
        }, 10);

    };
    $('#browse_number_img').mouseenter(() => {
        leaveImgAndDiv[0] = false;
        if (!document.getElementById('browse_number_div')) {
            createBrowseRecordDivFunc();
            viewMouseWhetherInAvailableArea();
        }
    });
    //当鼠标不在图像上或者在显示div上就10秒消失
    $('#browse_number_img').mouseleave(() => {
        leaveImgAndDiv[0] = true;
    });
</script>
</html>